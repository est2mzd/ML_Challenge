### 学習時の損失関数

学習時には、モデルが最適化されるために使用される損失関数は、以下の複数のコンポーネントから構成されます。各コンポーネントは異なる目的を持ち、全体としてモデルの性能を向上させるために協力します。

1. **模倣損失( $L_i$ )**:
   - モデルが提供された地上真理の軌道を再現するようにトレーニングするための損失です。
   - 数式:
     ```math
     L_i = L1_{\text{smooth}}(\hat{\tau}, \tau^{\text{gt}}) + L1_{\text{smooth}}(\tau^{\text{free}}, \tau^{\text{gt}})
     ```

2. **予測損失( $L_p$ )**:
   - 各動的エージェントのエンコードされた埋め込みに基づいて正確な予測を生成するための損失です。
   - 数式:
     ```math
     L_p = L1_{\text{smooth}}(P_{1:NA}, P^{\text{gt}}_{1:NA})
     ```

3. **補助損失( $L_{\text{aux}}$ )**:
   - 車両が走行可能エリアから外れたり、障害物と衝突したりしないように制約を加えるための損失です。これは、安全性を確保するために重要です。
   - 数式:
     ```math
     L_{\text{aux}} = \frac{1}{T_f} \sum_{t=1}^{T_f} \sum_{i=1}^{N_c} \max(0, R_c + \epsilon - d_i^t)
     ```

4. **対照損失( $L_c$ )**:
   - 類似するサンプル間の一致を強化し、異なるサンプル間の類似性を低減することで、モデルが因果関係を適切に学習できるようにする損失です。
   - 数式:
     ```math
     L_c = -\log \frac{\exp(\text{sim}(z, z^+)/\sigma)}{\exp(\text{sim}(z, z^+)/\sigma) + \exp(\text{sim}(z, z^-)/\sigma)}
     ```

5. **全体の損失関数**:
   - 上記の損失項目を重み付きで合計したものが、学習時の全体的な損失関数となります。
   - 数式:
     ```math
     L = w_1 L_i + w_2 L_p + w_3 L_{\text{aux}} + w_4 L_c
     ```

### 推論時の損失関数

[Sec3_Equation.md の 3.6](./Sec3_Equation.md#section-36)　を参照してください
