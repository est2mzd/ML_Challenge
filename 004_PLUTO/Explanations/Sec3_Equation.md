# 数式の解説

## 3.1 Problem Formulation（問題定式化）

### 数式 1: 自動運転計画の基本定式化

```math
(T_0, \pi_0), P_{1:NA} = f(A, O, M, C | \phi)
```

- **目的**: 自動運転車（AV）のための計画軌道 $(T_0, \pi_0)$ と周囲の動的エージェントの予測 $P_{1:NA}$ を生成します。
- **変数**:
  - $A$: エージェントの特徴。
  - $O$: 静的障害物。
  - $M$: 高精度マップ情報。
  - $C$: 交通信号の状態。
  - $\phi$: モデルのパラメータ。
  - $f$: PLUTOのニューラルネットワーク。

この数式は、AVとその周囲の環境情報を統合し、計画と予測を行うフレームワークを提供します。

### 数式 2: 最適軌道の選択

```math
(\tau^*, \pi^*) = \arg\max_{(\tau, \pi) \in (T_0, \pi_0)} S(\tau, \pi, P_{1:NA}, O, M, C)
```

- **目的**: シーンの文脈を考慮して、最も適切な軌道 ($\tau^*$, $\pi^*$) を選択します。
- **変数**:
  - $\tau$, $\pi$: 候補の軌道とその信頼度スコア。
  - $S$: スコアリングモジュール。

この数式は、生成された軌道候補から最も適切なものを選び出すプロセスを表しています。

## 3.2 Input Representation and Scene Encoding（入力表現とシーンエンコーディング）

### 数式 3: エージェント履歴の差分表現

```math
\hat{s}^t_i = (p^t_i - p^{t-1}_i, \theta^t_i - \theta^{t-1}_i, v^t_i - v^{t-1}_i, b^t_i, I^t_i)
```

- **目的**: エージェントの履歴情報を差分として表現し、時系列情報を抽出します。
- **変数**:
  - $p^t_i$, $\theta^t_i$, $v^t_i$: エージェントの位置、方向、速度。
  - $b^t_i$: バウンディングボックスの寸法。
  - $I^t_i$: 状態のバイナリ指標。

この数式は、時間経過に伴うエージェントの変化を捉えます。

### 数式 4: エージェント特徴ベクトル

```math
F_A \in \mathbb{R}^{N_A \times (T_H-1) \times 8}
```

- **目的**: エージェントの特徴をベクトル形式で表現します。
- **変数**:
  - $N_A$: エージェントの数。
  - $T_H$: 履歴時間ステップの数。

この数式は、エージェントの過去の動きをベクトル形式で表現する方法を示しています。

### 数式 5: シーンエンコーディングの統合テンソル

```math
E_0 = \text{concat}(E_{AV}, E_A, E_O, E_P) + PE + E_{attr}
```

- **目的**: AV、エージェント、静的障害物、マップ情報を統合し、シーンの全体像をエンコードします。
- **変数**:
  - $E_{AV}$, $E_A$, $E_O$, $E_P$: それぞれAV、エージェント、障害物、マップの埋め込み。
  - $PE$: フーリエ埋め込みを使った位置情報。
  - $E_{attr}$: 意味属性の埋め込み。

この数式は、シーン全体を一つのテンソルにまとめることで、複雑な相互作用をキャプチャする方法を示しています。

## 3.3 Multi-modal Planning Trajectory Decoding（マルチモーダル計画軌道デコーディング）

### 数式 6: 初期クエリの投影

```math
Q_0 = \text{Projection}(\text{concat}(Q_{lat}, Q_{lon}))
```

- **目的**: 横方向と縦方向のクエリを結合し、初期クエリセットを生成します。
- **変数**:
  - $Q_{lat}$, $Q_{lon}$: 横方向と縦方向のクエリ。

この数式は、横方向と縦方向の運転行動を統合する方法を示しています。

### 数式 7: 軌道デコーディングの自己注意

```math
Q'_{i-1} = \text{SelfAttn}(Q_{i-1}, \text{dim} = 0)
```

```math
\hat{Q}_{i-1} = \text{SelfAttn}(Q'_{i-1}, \text{dim} = 1)
```

```math
Q_i = \text{CrossAttn}(\hat{Q}_{i-1}, E_{enc}, E_{enc})
```

- **目的**: 横方向自己注意、縦方向自己注意、シーン情報とのクロスアテンションを通じて軌道をデコードします。
- **変数**:
  - $\text{SelfAttn}(X, \text{dim} = i)$: $X$ の $i$ 次元での自己注意。
  - $\text{CrossAttn}(Q, K, V)$: クロスアテンション操作。

これらの数式は、マルチモーダルな軌道を生成するために複数の注意メカニズムを利用する方法を示しています。

### 数式 8: 軌道とスコアの生成

```math
T_0 = \text{MLP}(Q_{dec}), \quad \pi_0 = \text{MLP}(Q_{dec})
```

- **目的**: デコーダの出力からAVの将来の軌道とそのスコアを決定します。
- **変数**:
  - $Q_{dec}$: 軌道デコーダの出力。

この数式は、デコードされたクエリから最終的な運転計画を生成する方法を示しています。
